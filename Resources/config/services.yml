services:

    syrup.components:
        class: Keboola\DockerBundle\Service\ComponentsService
        arguments: [@syrup.storage_api]

    syrup.encryption.component_wrapper:
        class: Keboola\DockerBundle\Encryption\ComponentWrapper
        arguments: [%encryption_key%]
        tags:
            - { name: syrup.encryption.wrapper }

    syrup.encryption.component_project_wrapper:
        class: Keboola\DockerBundle\Encryption\ComponentProjectWrapper
        arguments: [%encryption_key%]
        tags:
            - { name: syrup.encryption.wrapper }

    syrup.job_executor:
        class: Keboola\DockerBundle\Job\Executor
        arguments:
          - @logger
          - @docker_bundle.runner
          - @syrup.object_encryptor
          - @syrup.components
          - @syrup.encryption.component_wrapper
          - @syrup.encryption.component_project_wrapper

    syrup.job_factory:
        class: Keboola\DockerBundle\Job\Metadata\JobFactory
        arguments: [%app_name%, @syrup.object_encryptor, @syrup.storage_api]

    docker_bundle.loggers:
        class: Keboola\DockerBundle\Service\LoggersService
        arguments: [@logger, @docker_bundle.monolog.logger, @docker_bundle.monolog.sapi_handler]

    docker_bundle.monolog.logger:
        class: Keboola\DockerBundle\Monolog\ContainerLogger
        arguments: [@logger]
        tags:
            - { name: monolog.logger, channel: container }

    syrup.monolog.sapi_handler:
        class: Keboola\DockerBundle\Monolog\Handler\StorageApiHandler
        arguments: ["%app_name%", "@syrup.storage_api"]

    docker_bundle.monolog.sapi_handler:
        class: Keboola\DockerBundle\Monolog\Handler\StorageApiHandler
        arguments: [%app_name%, @syrup.storage_api]

    docker_bundle.runner:
        class: Keboola\DockerBundle\Service\Runner
        arguments: [@syrup.temp, @syrup.object_encryptor, @syrup.storage_api, @docker_bundle.loggers]
